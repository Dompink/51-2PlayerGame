#include <REG51.H>    
#include <INTRINS.H> 
#include <bgm1.h>

/*******************************************************************************
* 函 数 名         : bgm
* 函数功能		     : play bgm
* 输    入         : none
* 输    出         : bgm
*******************************************************************************/


//本例采用89C52, 晶振为12MHZ     
unsigned char n=0;  //n为节拍常数变量
unsigned char code music_tab[] ={
//格式为: 频率常数, 节拍常数, 频率常数, 节拍常数,
/*0x1c 6*/ 
/*0x20 5*/
/*0x23 4*/
/*0x27 3*/
/*0x2b 2*/
/*0x30 1*/
/*0x40 5低音*/
/*0x40 为一整拍*/
	



//两只老虎
//1231(all 1/2拍) 1231(all 1/2拍)
0x30,0x20,
0x2b,0x20,
0x27,0x20,
0x30,0x20,
0x30,0x20,
0x2b,0x20,
0x27,0x20,
0x30,0x20,
//34(1/2拍)5 34(1/2拍)5
0x27,0x20,
0x23,0x20,
0x20,0x40,
0x27,0x20,
0x23,0x20,
0x20,0x40,
//5654(1/2拍)
0x20,0x20,
0x1c,0x20,
0x20,0x20,
0x23,0x20,
//31
0x27,0x40,
0x30,0x40,
//5654(1/2拍)
0x20,0x20,
0x1c,0x20,
0x20,0x20,
0x23,0x20,
//31
0x27,0x40,
0x30,0x40,
//2 (5低音）
0x2b,0x40,
0x40,0x40,
//1 
0x30,0x80,

//2 (5低音）
0x2b,0x40,
0x40,0x40,
//1 
0x30,0x80,

0x00

};   
   
void int0()  interrupt 1   //采用中断0 控制节拍    
{  TH0=0xd8;   //11011000，216
   TL0=0xf1;   //11110001，241，计数为25，约为0.25us
   n--;   
}   
   
void delaybgm(unsigned char m)   //控制频率延时    
{   
 unsigned i=3*m;   
 while(--i);   
}   
   
void delayms(unsigned char a)  //豪秒延时子程序    
{   
  while(--a);                  //采用while(--a) 不要采用while(a--); 
}   
   
void bgm1main()   
{ unsigned char p,m;   //m为频率常数变量    
  unsigned char i=0;   
  TMOD&=0x0f;   //00001111
  TMOD|=0x01;   //00000001
  TH0=0xd8;TL0=0xf1;   //TH0=11011000(2),216(10),TL0=11110001(2),241,计数为25，0.25us
  IE=0x82;//10000010
play:   
   while(1)   
    {   
    a: p=music_tab[i];   
       if(p==0x00)       { i=0, delayms(1000); goto play;}     //如果碰到结束符,延时1秒,回到开始再来一遍    
       else if(p==0xff)  { i=i+1;delayms(100),TR0=0; goto a;}  //若碰到休止符,延时100ms,继续取下一音符    
            else         {m=music_tab[i++], n=music_tab[i++];} //取频率常数和节拍常数    
             TR0=1;                                            //开定时器1    
           while(n!=0) Beep=~Beep,delaybgm(m);                    //等待节拍完成, 通过P1口输出音频(可多声道哦!)    
       TR0=0;                                             		 //关定时器1    
    }   
}  


/*0x18, 0x30, 0x1C , 0x10,//24,48;28,16
0x20, 0x40, 0x1C , 0x10,//32,64;28,16 
0x18, 0x10, 0x20 , 0x10,//24,16;32,16
0x1C, 0x10, 0x18 , 0x40,//28,16;24,64 
0x1C, 0x20, 0x20 , 0x20,//28,32;32,32   
0x1C, 0x20, 0x18 , 0x20,//28,32;24,32   
0x20, 0x80,//八月桂花遍地开*/

/*小星星	
//1155665-
0x30,0x40,
0x30,0x40,
0x20,0x40,
0x20,0x40,
0x1c,0x40,
0x1c,0x40,
0x20,0x80,
//4433221-
0x23,0x40,
0x23,0x40,
0x27,0x40,
0x27,0x40,
0x2b,0x40,
0x2b,0x40,
0x30,0x80,
//5544332-
0x20,0x40,
0x20,0x40,
0x23,0x40,
0x23,0x40,
0x27,0x40,
0x27,0x40,
0x2b,0x80,
//5544332- //
0x20,0x40,
0x20,0x40,
0x23,0x40,
0x23,0x40,
0x27,0x40,
0x27,0x40,
0x2b,0x80,
//1155665- //
0x30,0x40,
0x30,0x40,
0x20,0x40,
0x20,0x40,
0x1c,0x40,
0x1c,0x40,
0x20,0x80,
//4433221- //
0x23,0x40,
0x23,0x40,
0x27,0x40,
0x27,0x40,
0x2b,0x40,
0x2b,0x40,
0x30,0x80,*/